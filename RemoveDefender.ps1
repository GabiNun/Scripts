$store = 'HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Appx\AppxAllUserStore'; $appx = Get-AppxPackage -Name Microsoft.SecHealthUI; $sids = @('S-1-5-18'); $sids += Get-ChildItem $store -ea 0 | % { $_.PSChildName } | ? { $_.StartsWith('S-1-5-21') }; New-Item -Path "$store\Deprovisioned\$($appx.PackageFamilyName)" -ItemType RegistryKey -Force | Out-Null; foreach ($sid in $sids) { New-Item -Path "$store\EndOfLife\$sid\$($appx.PackageFullName)" -ItemType RegistryKey -Force | Out-Null }; $appx | Remove-AppxPackage
iwr 'github.com/ionuttbara/windows-defender-remover/raw/main/Remove_Defender/RemoveDefender.reg' -OutFile "$env:TEMP\RemoveDefender.reg";iwr 'github.com/ionuttbara/windows-defender-remover/raw/main/Remove_SecurityComp/Remove_SecurityComp.reg' -OutFile "$env:TEMP\Remove_SecurityComp.reg";Install-PackageProvider NuGet -Force | Out-Null;Install-Module NtObjectManager -Force -Confirm:$false;Set-ExecutionPolicy Bypass -Force
Start-Service TrustedInstaller; New-Win32Process -Config (New-Win32ProcessConfig -CommandLine "cmd.exe /c reg import `"$env:TEMP\RemoveDefender.reg`" & reg import `"$env:TEMP\Remove_SecurityComp.reg`"" -CreationFlags NewConsole -ParentProcess (Get-NtProcess -ServiceName TrustedInstaller)) | Out-Null

Register-ScheduledTask -TaskName r -Action (New-ScheduledTaskAction -Execute reg -Argument "import $env:temp\RemoveDefender.reg");$s=New-Object -ComObject Schedule.Service;$s.Connect();$s.GetFolder('\').GetTask('r').RunEx($null,0,0,'NT SERVICE\TrustedInstaller');Unregister-ScheduledTask -TaskName r -Confirm:$false
Register-ScheduledTask -TaskName r -Action (New-ScheduledTaskAction -Execute reg -Argument "import $env:temp\Remove_SecurityComp");$s=New-Object -ComObject Schedule.Service;$s.Connect();$s.GetFolder('\').GetTask('r').RunEx($null,0,0,'NT SERVICE\TrustedInstaller');Unregister-ScheduledTask -TaskName r -Confirm:$false
